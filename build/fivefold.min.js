/*! fivefold v0.1.1 | MIT Licence | https://github.com/yaakaito/fivefold | (c) 2013 yaakaito.org  */
var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},fivefold;!function(a){function b(a){return"function"==typeof a&&!(a instanceof RegExp)}function c(a){return"object"!=typeof a?!1:"function"==typeof a.on&&"function"==typeof a.off}function d(a,c){return b(a)?function(){return a.apply(c||this,Array.prototype.slice.call(arguments))}:void 0}function e(){return"view"+l++}function f(a,b,c){if(!a.$el){var d=null;d=b?$(b,c):$("<"+a.tagName+">");var e={};for(var f in a.attributes)e[f]=a.attributes[f];a.id&&(e.id=a.id),a.className&&(e["class"]=a.className),a.$el=d.attr(e)}}function g(a,b){var c=y;if("string"==typeof b){var d=b.split(B);c.registerRoute(new w(a,d[0],d[1]))}}function h(a,b){var c=A,d=b.split(B),e=null;e="number"==typeof a?new w(""+a,d[0],d[1]):new w(a,d[0],d[1]),c.registerRoute(e)}a.silent=!1;var i=function(b){a.silent||console.log(b.message)},j=/\./,k=function(){function a(){this.prefix="",this.suffix=""}return a.prototype.realizeTry=function(a){var b=this;return monapt.Try(function(){return b.realize(a)})},a.prototype.realize=function(a){var b=this.getClass(this.parsePathOrName(a));return new b},a.prototype.parsePathOrName=function(a){return a.split(j)},a.prototype.getClass=function(a){for(var b,c=window,d=0,e=a.length;e>d;d++)b=a[d],c=c[d==e-1?this.prefix+b+this.suffix:b];return c},a}();a.Realizer=k;var l=0,m=/^(\S+)\s*(.*)$/,n=function(){function a(a){"undefined"==typeof a&&(a={}),this.cid=e(),this.$el=null,this.tagName="div",this.id="",this.className="",this.attributes={},this.autoRender=!0;var b=null==a.delegate?!0:a.delegate,d=a.selector,g=a.context;this.$el=c(a.$el)?a.$el:null,this.tagName=a.tagName||"div",this.id=a.id||"",this.className=a.className||"",this.attributes="object"==typeof a.attributes?a.attributes:{},f(this,d,g),b&&this.delegateEvents()}return a.prototype.events=function(){return null},a.prototype.delegateEvents=function(a){var c=this;if(!a&&!(a=this.events()))return this;this.undelegateAll();var e=new monapt.Map(a);return e.mapValues(function(a){return b(a)?a:c[a]}).filter(function(a,c){return b(c)}).map(function(a,b){var e=a.match(m);return monapt.Tuple2(e[1],monapt.Tuple2(e[2],d(b,c)))}).foreach(function(a,b){return c.delegate(a,b._1,b._2)}),this},a.prototype.delegate=function(a,b,c){var d=a+".ff"+this.cid;this.$el.on.call(this.$el,d,b,c)},a.prototype.undelegateAll=function(){this.$el.off(".ff"+this.cid)},a.prototype.render=function(){return this},a}();a.View=n;var o=function(a){function b(){a.apply(this,arguments),this.$el=$(document.body),this.$content=$(document.body)}return __extends(b,a),b.prototype.beforeDisplayContent=function(){},b.prototype.display=function(a){this.$content.html(a)},b}(n);a.Layout=o;var p=new o,q=function(){function a(){this.layout=p}return a.prototype.dispatch=function(a,b){var c=this;this.layout.render();var d=new monapt.Promise,e=this[a](b);return e.onComplete(function(a){return a.match({Success:function(a){try{a.autoRender&&a.render(),c.layout.beforeDisplayContent(),c.layout.display(a.$el),d.success(a)}catch(b){i(b),d.failure(b)}},Failure:function(a){d.failure(a),i(a)}})}),d.future()},a}();a.Controller=q;var r=function(){function a(){}return a.prototype.controllerForRouteTry=function(a){var b=new t;return b.realizeTry(a.controller).filter(function(a){return a instanceof q})},a}(),s=new r,t=function(a){function b(){a.apply(this,arguments),this.suffix="Controller"}return __extends(b,a),b}(k);a.ControllerRealizer=t;var u=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b}(monapt.Future);a.ActionFuture=u,a.actionFuture=function(a){return monapt.future(function(b){return a(b)})};var v=function(){function a(a,b){this.name=a,this.message=b}return a}();a.ActionError=v;var w=function(){function a(a,b,c){this.pattern=a,this.controller=b,this.method=c}return a}();a.Route=w;var x=function(){function a(){this.routes={}}return a.prototype.routesMap=function(){return new monapt.Map(this.routes)},a.prototype.registerRoute=function(a){this.routes[a.pattern]=a},a}(),y=new x,z=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.routeForError=function(b){return a.prototype.routesMap.call(this).get(b.name)},b}(x),A=new z,B=/::/;!function(a){a[a.NotFound=-1]="NotFound",a[a.DispatchFailure=-2]="DispatchFailure"}(a.RouteError||(a.RouteError={})),a.RouteError;var C=function(){return new v("-1","")},D=[];a.history={previous:function(a){return"undefined"==typeof a&&(a=1),D.length<=1?[]:D.slice(0,D.length-2).slice(-a).reverse()},current:function(){return D[D.length-1]}};var E=[],F=function(){function a(a){this.resolver=a,this.dispatcher=new G,this.start()}return a.prototype.start=function(){var a=this;window.onhashchange=function(){a.onHashChange()},setTimeout(function(){return a.onHashChange()},0)},a.prototype.onHashChange=function(){var a=this,b=location.hash,c=this.resolver.resolve(b,y.routesMap());c.onComplete(function(b){return b.match({Success:function(b){return a.dispatcher.dispatch(b.route,b.options)},Failure:function(){return a.dispatcher.dispatchError(C())}})})},a.prototype.reload=function(){this.onHashChange()},a.prototype.routes=function(a){a(g)},a.prototype.errorRoutes=function(a){a(h)},a.prototype.listen=function(a){E.push(a)},a}();a.Router=F;var G=function(){function a(){}return a.prototype.dispatch=function(a,b){var c=this;s.controllerForRouteTry(a).match({Success:function(d){d.dispatch(a.method,b).onFailure(function(a){c.dispatchError(a)}),D.push(a);for(var e=0,f=E.length;f>e;e++)E[e](a)},Failure:function(a){return c.dispatchError(a)}})},a.prototype.dispatchError=function(a){var b=this;A.routeForError(a).match({Some:function(c){b.dispatch(c,a)},None:function(){i(new Error("Route not found: "+a.message))}})},a}()}(fivefold||(fivefold={}));